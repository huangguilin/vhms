{{include file='common/head.html'}}
<body bgcolor='#ffffff' text='#000000' leftmargin='0' topmargin='0'>
<script language='javascript' src='{{$PSTATIC}}/style/common.js'></script>
<script language='javascript'>
var xmlhttp2=new Array();
function changeNodeResult(id) { 
	var recv_msg=false;
	try{
	 if (xmlhttp2[id].readyState==4) {
		if(xmlhttp2[id].status==200){	
			//alert(xmlhttp2[id].responseText);	
			xxkf_obj('busy'+id).innerHTML = "";
		 	var dataArray = xmlhttp2[id].responseXML.getElementsByTagName('result');
		 	var code = dataArray[0].getAttribute('code');
		 	if(code==2){
			 	alert('更新主机失败，该主机上没有相应模板');
		 	}else if(code==0){
			 	alert('更新主机失败');
		 	}		 		
		}
	  }
	}catch(e){
		alert(e);
	}
}
function changeNode(id,templete)
{
	//alert('id='+id);
	//alert(xxkf_obj('node'+id).selectedIndex);
	var node = xxkf_obj('node'+id).value;
	//alert(node_value);
	var url='?c={{$smarty.request.c}}&a=ajaxChangeNode&id='+id + '&node=' + node + '&templete=' + templete;
	xxkf_obj('busy'+id).innerHTML="<img src='{{$PSTATIC}}/style/busy.gif'/>";
	xmlhttp2[id] = create_xmlhttp();	
	xmlhttp2[id].open("GET",url,true);	
	xmlhttp2[id].onreadystatechange=function (){
		changeNodeResult(id);
	};
	xmlhttp2[id].send(null);
}
function updateView(id,product_id)
{
	xxkf_obj('updateView').innerHTML="";
	var view=0;
	if(document.getElementById(id).checked)
	{
		view=1;
	}
	var url='?c={{$smarty.request.c}}&a=ajaxUpdateProductView&id='+product_id+'&view='+view;
	ajax_open_url2(url,updateViewResult);
}
function updateViewResult()
{
	var id='updateView';
	try{
	 if (xmlhttp2.readyState==4) {
		if(xmlhttp2.status==200){	
			//alert(xmlhttp2[id].responseText);	
		 	var dataArray = xmlhttp2.responseXML.getElementsByTagName('result');
		 	var ret = dataArray[0].getAttribute('ret');
		 	if(ret==1)
		 	{
		 		xxkf_obj(id).innerHTML = "增加失败，请检查";
		 	}	 		
		}
	  }
	}catch(e){
		alert(e);
	}
}
</script>
<div style="float:center">
 <div class="padd mar_top"></div>
  <div id="main" class="wid" > 
  		<div  >
		  <form action='?c={{$smarty.request.c}}&a={{$smarty.request.a}}' method='post' name='product_form'>
		  [<a href='?c=vhostproduct&a=flush'>更新配置文件</a>]
		  [<a href="?c=vhostproduct&a=addProductForm" target='main'>增加产品</a>]
		  <select name='product_flag' onChange="javascript:product_form.submit();">
		  <option value='0' {{if $product_flag==0}}selected{{/if}}>所有产品</option>
		  <option value='1' {{if $product_flag==1}}selected{{/if}}>暂停产品</option>
		  <option value='2' {{if $product_flag==2}}selected{{/if}}>可销售产品</option>
		  </select>
		  <span id='updateView' color='red'></span><div class="topimg pal1">共计 {{$sum}} 条记录</div>
		  </form>
  		</div>
  		
  		
   		<table cellpadding=0 cellspacing=1 id="table">
      	<tr id="ttitle">
	        <td class='color01 right' bgcolor='#efefef'>操作</td>
	        <td class='color01 right' bgcolor='#efefef'>前台显示</td>
		   	<td class='color01 right' bgcolor='#efefef' width="60">产品ID</td>
	        <td class='color01 right' bgcolor='#efefef'>产品名称</td>
	        <td class='color01 right' bgcolor='#efefef'>主机</td>
			<td class='color01 right' bgcolor='#efefef'>空间(M)</td>
			<td class='color01 right' bgcolor='#efefef'>数据库(M)</td>
			<td class='color01 right' bgcolor='#efefef'>价格(元/年)</td>	
			<td class='color01 right' bgcolor='#efefef'>绑定域名</td>	
			<td class='color01 right' bgcolor='#efefef'>绑定子目录</td>	
			<td class='color01 right' bgcolor='#efefef'>模板</td>		
			<td class='color01 right' bgcolor='#efefef'>状态</td>    
     	</tr>
	  	{{foreach from=$list item=row}}
     	<tr>
	        <td class="right">
	        	[<a href="javascript:if(confirm('确定删除{{$row.name}}?')){location='?c=vhostproduct&a=del&id={{$row.id}}';}" title="删除">删除</a>]
	       		[<a href="?c=vhostproduct&a=editProductForm&id={{$row.id}}">更改</a>]
			</td>
	        <td class="right">
	        	<input type='checkbox' id='view{{$row.id}}' onclick="updateView(this.id,{{$row.id}})" name='view' value='{{$row.view}}' {{if $row.view==1}}checked{{/if}}>
	        </td>

        	<td class="right">{{$row.id}}</td>
			<td class="right">{{$row.name}}</td>
			<td class="right">
				<select id='node{{$row.id}}' name='node' onChange="changeNode('{{$row.id}}','{{$row.templete}}')"">
				{{foreach from=$nodes item=node}}
				<option value='{{$node}}' {{if $row.node==$node}}selected{{/if}}>
				{{$node}}
				</option>
				{{/foreach}}
				</select>
				<div id='busy{{$row.id}}'></div>
			</td>
			<td class="right">{{$row.web_quota}}</td>
			<td class="right">{{$row.db_quota}}</td>
			<td class="right">{{$row.price/100}}</td>
			<td class="right">{{$row.domain}}</td>
			<td class="right">{{if $row.subdir_flag}}允许{{/if}} {{$row.subdir}}</td>
			<td class="right">{{$row.templete}}
				{{if $row.subtemplete}}:{{$row.subtemplete}}{{/if}}
			</td>
			<td class="right">
				{{if $row.pause_flag!=0}}暂停销售 {{/if}}
				{{if $row.month_flag!=0}}月付 {{/if}}
			</td>
	        </td>
      	</tr>
	  	{{/foreach}}
    	</table>
  </div>
</div>
</body>
{{include file='common/foot.html'}}